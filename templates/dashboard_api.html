{% extends 'base.html' %}
{% block content %}
<div class="container" style="max-width:1000px">
  <div class="page-heading">
    <h2>API</h2>
    <p class="muted">API keys, docs, and integration settings.</p>
  </div>

  <div class="card">
    <h3>API tokens</h3>
    {% if new_token %}
      <div class="card" style="background:#f8f9fa;padding:1rem;margin-bottom:1rem">
        <strong>New token (save this now):</strong>
        <pre style="white-space:pre-wrap;word-break:break-all">{{ new_token }}</pre>
        <div class="muted">This token will not be displayed again.</div>
      </div>
    {% endif %}

    <form action="{{ url_for('main.dashboard_api_create_token') }}" method="post" style="margin-bottom:1rem">
      <label>Token name</label>
      <input name="name" placeholder="e.g. integration-service" />
      <div style="margin-top:0.5rem">
        <button class="btn btn-primary" type="submit">Create token</button>
      </div>
    </form>

    <h4>Your tokens</h4>
    {% if tokens and tokens|length > 0 %}
      <table style="width:100%;border-collapse:collapse">
        <thead>
          <tr><th>Name</th><th>Created</th><th>Revoked</th><th></th></tr>
        </thead>
        <tbody>
        {% for t in tokens %}
          <tr>
            <td>{{ t.name or 'token-'+t.id }}</td>
            <td>{{ t.created_at }}</td>
            <td>{{ t.revoked_at or 'â€”' }}</td>
            <td>
              {% if not t.revoked_at %}
                <form action="{{ url_for('main.dashboard_api_revoke', token_id=t.id) }}" method="post" style="display:inline">
                  <button class="btn btn-danger" type="submit">Revoke</button>
                </form>
              {% else %}
                <span class="muted">Revoked</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="muted">You have not created any API tokens yet.</div>
    {% endif %}
  </div>

  <div class="card" style="margin-top:1rem">
    <h3>API documentation</h3>
    <p class="muted">Example: Use the token in an Authorization header:</p>
    <pre>Authorization: Bearer &lt;YOUR_TOKEN&gt;</pre>
    <p>Endpoint example: <code>/api/chat</code> accepts POST JSON {"message": "..."} and returns {"reply": "..."}.</p>
  </div>
</div>
{% endblock %}
