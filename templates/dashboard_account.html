{% extends 'base.html' %}
{% block content %}
<div class="container" style="max-width:1100px">
  <div class="page-heading">
    <h2>Account settings</h2>
    <p class="muted">Manage your account information and credentials.</p>
  </div>

  <div class="grid" style="display:grid;grid-template-columns:1fr 320px;gap:1rem">
    <div>
      <div class="card">
        <h3>Profile</h3>
        <form action="{{ url_for('main.complete_profile') }}" method="post">
          <label>Full name</label>
          <input name="full_name" type="text" value="{{ user.full_name if user and user.full_name else '' }}" />
          <label>Company</label>
          <input name="company" type="text" value="{{ user.company if user and user.company else '' }}" />
          <label>Phone</label>
          <input name="phone" type="text" value="{{ user.phone if user and user.phone else '' }}" />
          <div style="margin-top:0.75rem">
            <button class="btn btn-primary" type="submit">Save profile</button>
            <a class="btn" href="{{ url_for('main.dashboard') }}">Cancel</a>
          </div>
        </form>
      </div>

      <div class="card" style="margin-top:1rem">
        <h3>Change password</h3>
        <form action="{{ url_for('main.dashboard_change_password') }}" method="post">
          <label>Current password</label>
          <input name="old_password" type="password" autocomplete="current-password" />
          <label>New password</label>
          <input name="new_password" type="password" autocomplete="new-password" />
          <label>Confirm new password</label>
          <input name="confirm_password" type="password" />
          <div style="margin-top:0.75rem">
            <button class="btn btn-primary" type="submit">Change password</button>
          </div>
        </form>
      </div>
    </div>

    <aside>
      <div class="card">
        <h4>Connected accounts</h4>
        <p class="muted">Link or unlink social logins.</p>
        <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:0.5rem">
          <li>
            <a class="social-btn" href="{{ url_for('main.oauth_login', provider='github') }}">
              <!-- GitHub -->
              <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" style="width:18px;height:18px"><path d="M12 .5A12 12 0 000 12.6c0 5.3 3.4 9.8 8.2 11.4.6.1.8-.2.8-.5v-2.1c-3.3.7-4-1.6-4-1.6-.6-1.5-1.5-1.9-1.5-1.9-1.2-.8.1-.8.1-.8 1.4.1 2.2 1.5 2.2 1.5 1.1 2 2.8 1.4 3.5 1.1.1-.9.4-1.4.7-1.7-2.6-.3-5.3-1.3-5.3-6 0-1.3.5-2.3 1.3-3.1-.1-.3-.6-1.4.1-2.8 0 0 1-.3 3.2 1.2a11 11 0 016 0c2.2-1.5 3.2-1.2 3.2-1.2.7 1.4.2 2.5.1 2.8.8.8 1.3 1.8 1.3 3.1 0 4.7-2.7 5.7-5.3 6 .4.4.8 1.1.8 2.2v3.3c0 .3.2.6.8.5A12 12 0 0012 .5z"/></svg>
              <span>Connect GitHub</span>
            </a>
          </li>
          <li>
            <a class="social-btn" href="{{ url_for('main.oauth_login', provider='gitlab') }}">
              <!-- GitLab -->
              <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" style="width:18px;height:18px"><path d="M12 2L9.27 8.8 2 9.67l5.64 4.13L5.64 22 12 18.77 18.36 22l-1.99-8.2L22 9.67l-7.27-.87L12 2z"/></svg>
              <span>Connect GitLab</span>
            </a>
          </li>
          <li>
            <a class="social-btn" href="{{ url_for('main.oauth_login', provider='linkedin') }}">
              <!-- LinkedIn -->
              <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" style="width:18px;height:18px"><path d="M4.98 3.5a2.5 2.5 0 11.02 5.001 2.5 2.5 0 01-.02-5zM3 9h4v12H3zM9 9h3.8v1.6h.05c.53-1 1.83-2.06 3.77-2.06C20.88 8.54 21 11 21 13.9V21h-4v-6.2c0-1.48-.03-3.39-2.07-3.39-2.07 0-2.39 1.62-2.39 3.29V21H9z"/></svg>
              <span>Connect LinkedIn</span>
            </a>
          </li>
          <li>
            <a class="social-btn" href="{{ url_for('main.oauth_login', provider='bitbucket') }}">
              <!-- Bitbucket -->
              <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" style="width:18px;height:18px"><path d="M21 3H3l1.5 14.5L12 21l7.5-3.5L21 3zM7.5 6.5h9L15 13l-3 1.5L9 13l-1.5-6.5z"/></svg>
              <span>Connect Bitbucket</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="card" style="margin-top:1rem">
        <h4>API & tokens</h4>
        <p class="muted">Create and manage API tokens for programmatic access.</p>
        <div style="display:flex;gap:0.5rem;margin-top:0.5rem;align-items:center">
          <input id="new-token-name" placeholder="Token name (optional)" style="padding:0.45rem;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:inherit">
          <button id="create-token-btn" class="btn btn-primary">Create token</button>
        </div>
        <div id="new-token-output" style="margin-top:0.6rem;display:none">
          <label style="font-weight:700">Save this token now — it will not be shown again</label>
          <div style="display:flex;gap:0.5rem;align-items:center;margin-top:0.5rem">
            <pre id="new-token-value" style="background:rgba(0,0,0,0.06);padding:0.6rem;border-radius:6px;font-family:monospace;overflow:auto;margin:0"></pre>
            <button id="copy-token-btn" class="btn">Copy</button>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:1rem">
        <h4>Your API tokens</h4>
        <p class="muted">Active tokens (you can revoke them)</p>
        <ul id="tokens-list" style="list-style:none;padding:0;margin:0;margin-top:0.5rem">
          {% for t in tokens %}
            <li style="display:flex;align-items:center;justify-content:space-between;padding:0.5rem;border-radius:6px;background:rgba(255,255,255,0.01);margin-bottom:0.5rem">
              <div>
                <div style="font-weight:700">{{ t.name or 'token' }}</div>
                <div class="muted" style="font-size:0.9rem">Created: {{ t.created_at }} {% if t.revoked_at %}• Revoked: {{ t.revoked_at }}{% endif %}</div>
              </div>
              <div style="display:flex;gap:0.5rem;align-items:center">
                {% if not t.revoked_at %}
                  <button class="btn revoke-token" data-token-id="{{ t.id }}">Revoke</button>
                {% else %}
                  <span class="muted">Revoked</span>
                {% endif %}
              </div>
            </li>
          {% else %}
            <li class="muted">No tokens yet.</li>
          {% endfor %}
        </ul>
      </div>
    </aside>
  </div>
</div>
{% endblock %}
